{"version":3,"sources":["../../../src/worker/AnalysisWebWorker.js"],"names":["assessments","bundledPlugins","helpers","markers","string","interpreters","config","YoastSEO","Assessor","Assessment","SEOAssessor","ContentAssessor","TaxonomyAssessor","Pluggable","Researcher","SnippetPreview","RelatedKeywordAssessor","Paper","AssessmentResult","keyphraseDistribution","seo","KeyphraseDistributionAssessment","logger","setDefaultLevel","AnalysisWebWorker","scope","_scope","_configuration","contentAnalysisActive","keywordAnalysisActive","useCornerstone","useTaxonomy","useKeywordDistribution","locale","_scheduler","_paper","_relatedKeywords","_i18n","createI18n","_researcher","_contentAssessor","_seoAssessor","_relatedKeywordAssessor","_results","readability","results","score","_registeredAssessments","_registeredMessageHandlers","analyze","bind","analyzeDone","analyzeRelatedKeywordsDone","loadScript","loadScriptDone","customMessage","customMessageDone","clearCache","runResearch","runResearchDone","registerAssessment","registerMessageHandler","refreshAssessment","handleMessage","analyzeRelatedKeywords","onmessage","analysisWorker","yoast","analysis","data","type","id","payload","parse","debug","initialize","startPolling","schedule","execute","done","name","error","Error","console","warn","assessor","researcher","getAssessment","addAssessment","forEach","assessment","serialize","postMessage","configuration","update","shouldAssessorsUpdate","translations","researchData","research","addResearchData","params","defaultQueryParams","setLevel","logLevel","createContentAssessor","createSEOAssessor","createRelatedKeywordsAssessor","send","pluginName","combinedName","push","handler","paper","getText","getLocale","key","keyword","synonyms","relatedKeywords","_text","removeHtmlBlocks","paperHasChanges","equals","shouldReadabilityUpdate","setPaper","setLocale","assess","calculateOverallScore","requestedRelatedKeywordKeys","relatedKeyword","relatedPaper","length","url","loaded","message","importScripts","result","success","getResearch","domain","locale_data","contentAssessor","seoAssessor","configurationKeys","Object","keys"],"mappings":"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","file":"AnalysisWebWorker.js","sourcesContent":["// External dependencies.\nimport { autop } from \"@wordpress/autop\";\nimport Jed from \"jed\";\nimport { forEach, has, includes, isNull, isObject, isString, isUndefined, merge, pickBy } from \"lodash-es\";\nimport { getLogger } from \"loglevel\";\n\n// YoastSEO.js dependencies.\nimport * as assessments from \"../assessments\";\nimport * as bundledPlugins from \"../bundledPlugins\";\nimport * as helpers from \"../helpers\";\nimport * as markers from \"../markers\";\nimport * as string from \"../stringProcessing\";\nimport * as interpreters from \"../interpreters\";\nimport * as config from \"../config\";\n\nimport Assessor from \"../assessor\";\nimport Assessment from \"../assessment\";\nimport SEOAssessor from \"../seoAssessor\";\nimport ContentAssessor from \"../contentAssessor\";\nimport TaxonomyAssessor from \"../taxonomyAssessor\";\nimport Pluggable from \"../pluggable\";\nimport Researcher from \"../researcher\";\nimport SnippetPreview from \"../snippetPreview\";\nimport Paper from \"../values/Paper\";\nimport AssessmentResult from \"../values/AssessmentResult\";\nimport RelatedKeywordAssessor from \"../relatedKeywordAssessor\";\n\nconst YoastSEO = {\n\tAssessor,\n\tAssessment,\n\tSEOAssessor,\n\tContentAssessor,\n\tTaxonomyAssessor,\n\tPluggable,\n\tResearcher,\n\tSnippetPreview,\n\tRelatedKeywordAssessor,\n\n\tPaper,\n\tAssessmentResult,\n\n\tassessments,\n\tbundledPlugins,\n\thelpers,\n\tmarkers,\n\tstring,\n\tinterpreters,\n\tconfig,\n};\n\n// Internal dependencies.\nimport CornerstoneContentAssessor from \"../cornerstone/contentAssessor\";\nimport CornerstoneRelatedKeywordAssessor from \"../cornerstone/relatedKeywordAssessor\";\nimport CornerstoneSEOAssessor from \"../cornerstone/seoAssessor\";\nimport InvalidTypeError from \"../errors/invalidType\";\nimport includesAny from \"../helpers/includesAny\";\nimport { configureShortlinker } from \"../helpers/shortlinker\";\nimport RelatedKeywordTaxonomyAssessor from \"../relatedKeywordTaxonomyAssessor\";\nimport Scheduler from \"./scheduler\";\nimport Transporter from \"./transporter\";\nimport wrapTryCatchAroundAction from \"./wrapTryCatchAroundAction\";\n\n\nconst keyphraseDistribution = new assessments.seo.KeyphraseDistributionAssessment();\n\nconst logger = getLogger( \"yoast-analysis-worker\" );\nlogger.setDefaultLevel( \"error\" );\n\n/**\n * Analysis Web Worker.\n *\n * Worker API:     https://developer.mozilla.org/en-US/docs/Web/API/Worker\n * Webpack loader: https://github.com/webpack-contrib/worker-loader\n */\nexport default class AnalysisWebWorker {\n\t/**\n\t * Initializes the AnalysisWebWorker class.\n\t *\n\t * @param {Object} scope The scope for the messaging. Expected to have the\n\t *                       `onmessage` event and the `postMessage` function.\n\t */\n\tconstructor( scope ) {\n\t\tthis._scope = scope;\n\n\t\tthis._configuration = {\n\t\t\tcontentAnalysisActive: true,\n\t\t\tkeywordAnalysisActive: true,\n\t\t\tuseCornerstone: false,\n\t\t\tuseTaxonomy: false,\n\t\t\tuseKeywordDistribution: false,\n\t\t\t// The locale used for language-specific configurations in Flesch-reading ease and Sentence length assessments.\n\t\t\tlocale: \"en_US\",\n\t\t};\n\n\t\tthis._scheduler = new Scheduler();\n\n\t\tthis._paper = null;\n\t\tthis._relatedKeywords = {};\n\n\t\tthis._i18n = AnalysisWebWorker.createI18n();\n\t\tthis._researcher = new Researcher( this._paper );\n\n\t\tthis._contentAssessor = null;\n\t\tthis._seoAssessor = null;\n\t\tthis._relatedKeywordAssessor = null;\n\n\t\t/*\n\t\t * The cached analyses results.\n\t\t *\n\t\t * A single result has the following structure:\n\t\t * {AssessmentResult[]} readability.results An array of assessment results; in serialized format.\n\t\t * {number}             readability.score   The overall score.\n\t\t *\n\t\t * The results have the following structure.\n\t\t * {Object} readability Content assessor results.\n\t\t * {Object} seo         SEO assessor results, per keyword identifier or empty string for the main.\n\t\t * {Object} seo[ \"\" ]   The result of the paper analysis for the main keyword.\n\t\t * {Object} seo[ key ]  Same as above, but instead for a related keyword.\n\t\t */\n\t\tthis._results = {\n\t\t\treadability: {\n\t\t\t\tresults: [],\n\t\t\t\tscore: 0,\n\t\t\t},\n\t\t\tseo: {\n\t\t\t\t\"\": {\n\t\t\t\t\tresults: [],\n\t\t\t\t\tscore: 0,\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t\tthis._registeredAssessments = [];\n\t\tthis._registeredMessageHandlers = {};\n\n\t\t// Bind actions to this scope.\n\t\tthis.analyze = this.analyze.bind( this );\n\t\tthis.analyzeDone = this.analyzeDone.bind( this );\n\t\tthis.analyzeRelatedKeywordsDone = this.analyzeRelatedKeywordsDone.bind( this );\n\t\tthis.loadScript = this.loadScript.bind( this );\n\t\tthis.loadScriptDone = this.loadScriptDone.bind( this );\n\t\tthis.customMessage = this.customMessage.bind( this );\n\t\tthis.customMessageDone = this.customMessageDone.bind( this );\n\t\tthis.clearCache = this.clearCache.bind( this );\n\t\tthis.runResearch = this.runResearch.bind( this );\n\t\tthis.runResearchDone = this.runResearchDone.bind( this );\n\n\t\t// Bind register functions to this scope.\n\t\tthis.registerAssessment = this.registerAssessment.bind( this );\n\t\tthis.registerMessageHandler = this.registerMessageHandler.bind( this );\n\t\tthis.refreshAssessment = this.refreshAssessment.bind( this );\n\n\t\t// Bind event handlers to this scope.\n\t\tthis.handleMessage = this.handleMessage.bind( this );\n\n\t\t// Wrap try/catch around actions.\n\t\tthis.analyzeRelatedKeywords =\n\t\t\twrapTryCatchAroundAction( logger, this.analyze, \"An error occurred while running the related keywords analysis.\" );\n\t\t/*\n\t\t * Overwrite this.analyze after we use it in this.analyzeRelatedKeywords so that this.analyzeRelatedKeywords\n\t\t * doesn't use the overwritten version. Therefore, this order shouldn't be changed.\n\t\t */\n\t\tthis.analyze = wrapTryCatchAroundAction( logger, this.analyze, \"An error occurred while running the analysis.\" );\n\t}\n\n\t/**\n\t * Registers this web worker with the scope passed to it's constructor.\n\t *\n\t * @returns {void}\n\t */\n\tregister() {\n\t\tthis._scope.onmessage = this.handleMessage;\n\t\tthis._scope.analysisWorker = {\n\t\t\tregisterAssessment: this.registerAssessment,\n\t\t\tregisterMessageHandler: this.registerMessageHandler,\n\t\t\trefreshAssessment: this.refreshAssessment,\n\t\t};\n\t\tthis._scope.yoast = this._scope.yoast || {};\n\t\tthis._scope.yoast.analysis = YoastSEO;\n\t}\n\n\t/**\n\t * Receives the post message and determines the action.\n\t *\n\t * See: https://developer.mozilla.org/en-US/docs/Web/API/Worker/onmessage\n\t *\n\t * @param {MessageEvent} event              The post message event.\n\t * @param {Object}       event.data         The data object.\n\t * @param {string}       event.data.type    The action type.\n\t * @param {string}       event.data.id      The request id.\n\t * @param {string}       event.data.payload The payload of the action.\n\t *\n\t * @returns {void}\n\t */\n\thandleMessage( { data: { type, id, payload } } ) {\n\t\tpayload = Transporter.parse( payload );\n\n\t\tlogger.debug( \"AnalysisWebWorker incoming:\", type, id, payload );\n\n\t\tswitch ( type ) {\n\t\t\tcase \"initialize\":\n\t\t\t\tthis.initialize( id, payload );\n\t\t\t\tthis._scheduler.startPolling();\n\t\t\t\tbreak;\n\t\t\tcase \"analyze\":\n\t\t\t\tthis._scheduler.schedule( {\n\t\t\t\t\tid,\n\t\t\t\t\texecute: this.analyze,\n\t\t\t\t\tdone: this.analyzeDone,\n\t\t\t\t\tdata: payload,\n\t\t\t\t\ttype: type,\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase \"analyzeRelatedKeywords\":\n\t\t\t\tthis._scheduler.schedule( {\n\t\t\t\t\tid,\n\t\t\t\t\texecute: this.analyzeRelatedKeywords,\n\t\t\t\t\tdone: this.analyzeRelatedKeywordsDone,\n\t\t\t\t\tdata: payload,\n\t\t\t\t\ttype: type,\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase \"loadScript\":\n\t\t\t\tthis._scheduler.schedule( {\n\t\t\t\t\tid,\n\t\t\t\t\texecute: this.loadScript,\n\t\t\t\t\tdone: this.loadScriptDone,\n\t\t\t\t\tdata: payload,\n\t\t\t\t\ttype: type,\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase \"runResearch\":\n\t\t\t\tthis._scheduler.schedule( {\n\t\t\t\t\tid,\n\t\t\t\t\texecute: this.runResearch,\n\t\t\t\t\tdone: this.runResearchDone,\n\t\t\t\t\tdata: payload,\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase \"customMessage\": {\n\t\t\t\tconst name = payload.name;\n\t\t\t\tif ( name && this._registeredMessageHandlers[ name ] ) {\n\t\t\t\t\tthis._scheduler.schedule( {\n\t\t\t\t\t\tid,\n\t\t\t\t\t\texecute: this.customMessage,\n\t\t\t\t\t\tdone: this.customMessageDone,\n\t\t\t\t\t\tdata: payload,\n\t\t\t\t\t\ttype: type,\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tthis.customMessageDone( id, { error: new Error( \"No message handler registered for messages with name: \" + name ) } );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\tconsole.warn( \"AnalysisWebWorker unrecognized action:\", type );\n\t\t}\n\t}\n\n\t/**\n\t * Initializes i18n object based on passed configuration.\n\t *\n\t * @param {Object} [translations] The translations to be used in the current\n\t *                                instance.\n\t *\n\t * @returns {Jed} Jed instance.\n\t */\n\tstatic createI18n( translations ) {\n\t\t// Use default object to prevent Jed from erroring out.\n\t\ttranslations = translations || {\n\t\t\tdomain: \"js-text-analysis\",\n\t\t\t// eslint-disable-next-line camelcase\n\t\t\tlocale_data: {\n\t\t\t\t\"js-text-analysis\": {\n\t\t\t\t\t\"\": {},\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\treturn new Jed( translations );\n\t}\n\n\t/**\n\t * Initializes the appropriate content assessor.\n\t *\n\t * @returns {null|ContentAssessor|CornerstoneContentAssessor} The chosen\n\t *                                                            content\n\t *                                                            assessor.\n\t */\n\tcreateContentAssessor() {\n\t\tconst {\n\t\t\tcontentAnalysisActive,\n\t\t\tuseCornerstone,\n\t\t\tlocale,\n\t\t} = this._configuration;\n\n\t\tif ( contentAnalysisActive === false ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst assessor = useCornerstone === true\n\t\t\t? new CornerstoneContentAssessor( this._i18n, { locale } )\n\t\t\t: new ContentAssessor( this._i18n, { locale } );\n\n\t\treturn assessor;\n\t}\n\n\t/**\n\t * Initializes the appropriate SEO assessor.\n\t *\n\t * @returns {null|SEOAssessor|CornerstoneSEOAssessor|TaxonomyAssessor} The chosen\n\t *                                                                     SEO\n\t *                                                                     assessor.\n\t */\n\tcreateSEOAssessor() {\n\t\tconst {\n\t\t\tkeywordAnalysisActive,\n\t\t\tuseCornerstone,\n\t\t\tuseKeywordDistribution,\n\t\t\tuseTaxonomy,\n\t\t\tlocale,\n\t\t} = this._configuration;\n\n\t\tif ( keywordAnalysisActive === false ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet assessor;\n\n\t\tif ( useTaxonomy === true ) {\n\t\t\tassessor = new TaxonomyAssessor( this._i18n );\n\t\t} else {\n\t\t\tassessor = useCornerstone === true\n\t\t\t\t? new CornerstoneSEOAssessor( this._i18n, { locale: locale, researcher: this._researcher } )\n\t\t\t\t: new SEOAssessor( this._i18n, { locale: locale, researcher: this._researcher } );\n\t\t}\n\n\n\t\tif ( useKeywordDistribution && isUndefined( assessor.getAssessment( \"keyphraseDistribution\" ) ) ) {\n\t\t\tassessor.addAssessment( \"keyphraseDistribution\", keyphraseDistribution );\n\t\t}\n\n\t\tthis._registeredAssessments.forEach( ( { name, assessment } ) => {\n\t\t\tif ( isUndefined( assessor.getAssessment( name ) ) ) {\n\t\t\t\tassessor.addAssessment( name, assessment );\n\t\t\t}\n\t\t} );\n\n\t\treturn assessor;\n\t}\n\n\t/**\n\t * Initializes the appropriate SEO assessor for related keywords.\n\t *\n\t * @returns {null|SEOAssessor|CornerstoneSEOAssessor|TaxonomyAssessor} The chosen\n\t *                                                                     related keywords\n\t *                                                                     assessor.\n\t */\n\tcreateRelatedKeywordsAssessor() {\n\t\tconst {\n\t\t\tkeywordAnalysisActive,\n\t\t\tuseCornerstone,\n\t\t\tuseTaxonomy,\n\t\t\tlocale,\n\t\t} = this._configuration;\n\n\t\tif ( keywordAnalysisActive === false ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet assessor;\n\n\t\tif ( useTaxonomy === true ) {\n\t\t\tassessor = new RelatedKeywordTaxonomyAssessor( this._i18n );\n\t\t} else {\n\t\t\tassessor = useCornerstone === true\n\t\t\t\t? new CornerstoneRelatedKeywordAssessor( this._i18n, { locale: locale, researcher: this._researcher } )\n\t\t\t\t: new RelatedKeywordAssessor( this._i18n, { locale: locale, researcher: this._researcher } );\n\t\t}\n\n\t\tthis._registeredAssessments.forEach( ( { name, assessment } ) => {\n\t\t\tif ( isUndefined( assessor.getAssessment( name ) ) ) {\n\t\t\t\tassessor.addAssessment( name, assessment );\n\t\t\t}\n\t\t} );\n\n\t\treturn assessor;\n\t}\n\n\t/**\n\t * Sends a message.\n\t *\n\t * @param {string} type      The message type.\n\t * @param {number} id        The request id.\n\t * @param {Object} [payload] The payload to deliver.\n\t *\n\t * @returns {void}\n\t */\n\tsend( type, id, payload = {} ) {\n\t\tlogger.debug( \"AnalysisWebWorker outgoing:\", type, id, payload );\n\n\t\tpayload = Transporter.serialize( payload );\n\n\t\tthis._scope.postMessage( {\n\t\t\ttype,\n\t\t\tid,\n\t\t\tpayload,\n\t\t} );\n\t}\n\n\t/**\n\t * Checks which assessors should update giving a configuration.\n\t *\n\t * @param {Object}   configuration          The configuration to check.\n\t * @param {Assessor} [contentAssessor=null] The content assessor.\n\t * @param {Assessor} [seoAssessor=null]     The SEO assessor.\n\t *\n\t * @returns {Object} Containing seo and readability with true or false.\n\t */\n\tstatic shouldAssessorsUpdate( configuration, contentAssessor = null, seoAssessor = null ) {\n\t\tconst readability = [ \"contentAnalysisActive\", \"useCornerstone\", \"locale\", \"translations\" ];\n\t\tconst seo = [ \"keywordAnalysisActive\", \"useCornerstone\", \"useTaxonomy\", \"useKeywordDistribution\", \"locale\", \"translations\", \"researchData\" ];\n\t\tconst configurationKeys = Object.keys( configuration );\n\n\t\treturn {\n\t\t\treadability: isNull( contentAssessor ) || includesAny( configurationKeys, readability ),\n\t\t\tseo: isNull( seoAssessor ) || includesAny( configurationKeys, seo ),\n\t\t};\n\t}\n\n\t/**\n\t * Configures the analysis worker.\n\t *\n\t * @param {number}  id                                     The request id.\n\t * @param {Object}  configuration                          The configuration object.\n\t * @param {boolean} [configuration.contentAnalysisActive]  Whether the content analysis is active.\n\t * @param {boolean} [configuration.keywordAnalysisActive]  Whether the keyword analysis is active.\n\t * @param {boolean} [configuration.useCornerstone]         Whether the paper is cornerstone or not.\n\t * @param {boolean} [configuration.useTaxonomy]            Whether the taxonomy assessor should be used.\n\t * @param {boolean} [configuration.useKeywordDistribution] Whether the keyphraseDistribution assessment should run.\n\t * @param {string}  [configuration.locale]                 The locale used in the seo assessor.\n\t * @param {Object}  [configuration.translations]           The translation strings.\n\t * @param {Object}  [configuration.researchData]           Extra research data.\n\t * @param {Object}  [configuration.defaultQueryParams]     The default query params for the Shortlinker.\n\t * @param {string}  [configuration.logLevel]               Log level, see: https://github.com/pimterry/loglevel#documentation\n\t *\n\t * @returns {void}\n\t */\n\tinitialize( id, configuration ) {\n\t\tconst update = AnalysisWebWorker.shouldAssessorsUpdate( configuration, this._contentAssessor, this._seoAssessor );\n\n\t\tif ( has( configuration, \"translations\" ) ) {\n\t\t\tthis._i18n = AnalysisWebWorker.createI18n( configuration.translations );\n\t\t\tdelete configuration.translations;\n\t\t}\n\n\t\tif ( has( configuration, \"researchData\" ) ) {\n\t\t\tforEach( configuration.researchData, ( data, research ) => {\n\t\t\t\tthis._researcher.addResearchData( research, data );\n\t\t\t} );\n\t\t\tdelete configuration.researchData;\n\t\t}\n\n\t\tif ( has( configuration, \"defaultQueryParams\" ) ) {\n\t\t\tconfigureShortlinker( { params: configuration.defaultQueryParams } );\n\t\t\tdelete configuration.defaultQueryParams;\n\t\t}\n\n\t\tif ( has( configuration, \"logLevel\" ) ) {\n\t\t\tlogger.setLevel( configuration.logLevel, false );\n\t\t\tdelete configuration.logLevel;\n\t\t}\n\n\t\tthis._configuration = merge( this._configuration, configuration );\n\n\t\tif ( update.readability ) {\n\t\t\tthis._contentAssessor = this.createContentAssessor();\n\t\t}\n\t\tif ( update.seo ) {\n\t\t\tthis._seoAssessor = this.createSEOAssessor();\n\t\t\tthis._relatedKeywordAssessor = this.createRelatedKeywordsAssessor();\n\t\t}\n\n\t\t// Reset the paper in order to not use the cached results on analyze.\n\t\tthis.clearCache();\n\n\t\tthis.send( \"initialize:done\", id );\n\t}\n\n\t/**\n\t * Register an assessment for a specific plugin.\n\t *\n\t * @param {string}   name       The name of the assessment.\n\t * @param {function} assessment The function to run as an assessment.\n\t * @param {string}   pluginName The name of the plugin associated with the assessment.\n\t *\n\t * @returns {boolean} Whether registering the assessment was successful.\n\t */\n\tregisterAssessment( name, assessment, pluginName ) {\n\t\tif ( ! isString( name ) ) {\n\t\t\tthrow new InvalidTypeError( \"Failed to register assessment for plugin \" + pluginName + \". Expected parameter `name` to be a string.\" );\n\t\t}\n\n\t\tif ( ! isObject( assessment ) ) {\n\t\t\tthrow new InvalidTypeError( \"Failed to register assessment for plugin \" + pluginName +\n\t\t\t\t\". Expected parameter `assessment` to be a function.\" );\n\t\t}\n\n\t\tif ( ! isString( pluginName ) ) {\n\t\t\tthrow new InvalidTypeError( \"Failed to register assessment for plugin \" + pluginName +\n\t\t\t\t\". Expected parameter `pluginName` to be a string.\" );\n\t\t}\n\n\t\t// Prefix the name with the pluginName so the test name is always unique.\n\t\tconst combinedName = pluginName + \"-\" + name;\n\n\t\tif ( this._seoAssessor !== null ) {\n\t\t\tthis._seoAssessor.addAssessment( combinedName, assessment );\n\t\t}\n\t\tthis._registeredAssessments.push( { combinedName, assessment } );\n\n\t\tthis.refreshAssessment( name, pluginName );\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Register a message handler for a specific plugin.\n\t *\n\t * @param {string}   name       The name of the message handler.\n\t * @param {function} handler    The function to run as an message handler.\n\t * @param {string}   pluginName The name of the plugin associated with the message handler.\n\t *\n\t * @returns {boolean} Whether registering the message handler was successful.\n\t */\n\tregisterMessageHandler( name, handler, pluginName ) {\n\t\tif ( ! isString( name ) ) {\n\t\t\tthrow new InvalidTypeError( \"Failed to register handler for plugin \" + pluginName + \". Expected parameter `name` to be a string.\" );\n\t\t}\n\n\t\tif ( ! isObject( handler ) ) {\n\t\t\tthrow new InvalidTypeError( \"Failed to register handler for plugin \" + pluginName +\n\t\t\t\t\". Expected parameter `handler` to be a function.\" );\n\t\t}\n\n\t\tif ( ! isString( pluginName ) ) {\n\t\t\tthrow new InvalidTypeError( \"Failed to register handler for plugin \" + pluginName +\n\t\t\t\t\". Expected parameter `pluginName` to be a string.\" );\n\t\t}\n\n\t\t// Prefix the name with the pluginName so the test name is always unique.\n\t\tname = pluginName + \"-\" + name;\n\n\t\tthis._registeredMessageHandlers[ name ] = handler;\n\t}\n\n\t/**\n\t * Refreshes an assessment in the analysis.\n\t *\n\t * Custom assessments can use this to mark their assessment as needing a\n\t * refresh.\n\t *\n\t * @param {string} name The name of the assessment.\n\t * @param {string} pluginName The name of the plugin associated with the assessment.\n\t *\n\t * @returns {boolean} Whether refreshing the assessment was successful.\n\t */\n\trefreshAssessment( name, pluginName ) {\n\t\tif ( ! isString( name ) ) {\n\t\t\tthrow new InvalidTypeError( \"Failed to refresh assessment for plugin \" + pluginName + \". Expected parameter `name` to be a string.\" );\n\t\t}\n\n\t\tif ( ! isString( pluginName ) ) {\n\t\t\tthrow new InvalidTypeError( \"Failed to refresh assessment for plugin \" + pluginName +\n\t\t\t\t\". Expected parameter `pluginName` to be a string.\" );\n\t\t}\n\n\t\tthis.clearCache();\n\t}\n\n\t/**\n\t * Clears the worker cache to force a new analysis.\n\t *\n\t * @returns {void}\n\t */\n\tclearCache() {\n\t\tthis._paper = null;\n\t}\n\n\t/**\n\t * Changes the locale in the configuration.\n\t *\n\t * If the locale is different:\n\t * - Update the configuration locale.\n\t * - Create the content assessor.\n\t *\n\t * @param {string} locale The locale to set.\n\t *\n\t * @returns {void}\n\t */\n\tsetLocale( locale ) {\n\t\tif ( this._configuration.locale === locale ) {\n\t\t\treturn;\n\t\t}\n\t\tthis._configuration.locale = locale;\n\t\tthis._contentAssessor = this.createContentAssessor();\n\t}\n\n\t/**\n\t * Checks if the paper contains changes that are used for readability.\n\t *\n\t * @param {Paper} paper The paper to check against the cached paper.\n\t *\n\t * @returns {boolean} True if there are changes detected.\n\t */\n\tshouldReadabilityUpdate( paper ) {\n\t\tif ( this._paper === null ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( this._paper.getText() !== paper.getText() ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn this._paper.getLocale() !== paper.getLocale();\n\t}\n\n\t/**\n\t * Checks if the related keyword contains changes that are used for seo.\n\t *\n\t * @param {string} key                     The identifier of the related keyword.\n\t * @param {Object} relatedKeyword          The related keyword object.\n\t * @param {string} relatedKeyword.keyword  The keyword.\n\t * @param {string} relatedKeyword.synonyms The synonyms.\n\t *\n\t * @returns {boolean} True if there are changes detected.\n\t */\n\tshouldSeoUpdate( key, { keyword, synonyms } ) {\n\t\tif ( isUndefined( this._relatedKeywords[ key ] ) ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( this._relatedKeywords[ key ].keyword !== keyword ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn this._relatedKeywords[ key ].synonyms !== synonyms;\n\t}\n\n\t/**\n\t * Runs analyses on a paper.\n\t *\n\t * The paper includes the keyword and synonyms data. However, this is\n\t * possibly just one instance of these. From here we are going to split up\n\t * this data and keep track of the different sets of keyword-synonyms and\n\t * their results.\n\t *\n\t * @param {number} id                        The request id.\n\t * @param {Object} payload                   The payload object.\n\t * @param {Object} payload.paper             The paper to analyze.\n\t * @param {Object} [payload.relatedKeywords] The related keywords.\n\t *\n\t * @returns {Object} The result, may not contain readability or seo.\n\t */\n\tanalyze( id, { paper, relatedKeywords = {} } ) {\n\t\t// Automatically add paragraph tags, like Wordpress does, on blocks padded by double newlines or html elements.\n\t\tpaper._text = autop( paper._text );\n\t\tpaper._text = string.removeHtmlBlocks( paper._text );\n\t\tconst paperHasChanges = this._paper === null || ! this._paper.equals( paper );\n\t\tconst shouldReadabilityUpdate = this.shouldReadabilityUpdate( paper );\n\n\t\tif ( paperHasChanges ) {\n\t\t\tthis._paper = paper;\n\t\t\tthis._researcher.setPaper( this._paper );\n\n\t\t\t// Update the configuration locale to the paper locale.\n\t\t\tthis.setLocale( this._paper.getLocale() );\n\t\t}\n\n\t\tif ( this._configuration.keywordAnalysisActive && this._seoAssessor ) {\n\t\t\tif ( paperHasChanges ) {\n\t\t\t\tthis._seoAssessor.assess( this._paper );\n\n\t\t\t\t// Reset the cached results for the related keywords here too.\n\t\t\t\tthis._results.seo = {};\n\t\t\t\tthis._results.seo[ \"\" ] = {\n\t\t\t\t\tresults: this._seoAssessor.results,\n\t\t\t\t\tscore: this._seoAssessor.calculateOverallScore(),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Start an analysis for every related keyword.\n\t\t\tconst requestedRelatedKeywordKeys = [ \"\" ];\n\t\t\tforEach( relatedKeywords, ( relatedKeyword, key ) => {\n\t\t\t\trequestedRelatedKeywordKeys.push( key );\n\n\t\t\t\tthis._relatedKeywords[ key ] = relatedKeyword;\n\n\t\t\t\tconst relatedPaper = Paper.parse( {\n\t\t\t\t\t...this._paper.serialize(),\n\t\t\t\t\tkeyword: this._relatedKeywords[ key ].keyword,\n\t\t\t\t\tsynonyms: this._relatedKeywords[ key ].synonyms,\n\t\t\t\t} );\n\n\t\t\t\tthis._relatedKeywordAssessor.assess( relatedPaper );\n\n\t\t\t\tthis._results.seo[ key ] = {\n\t\t\t\t\tresults: this._relatedKeywordAssessor.results,\n\t\t\t\t\tscore: this._relatedKeywordAssessor.calculateOverallScore(),\n\t\t\t\t};\n\t\t\t} );\n\n\t\t\t// Clear the unrequested results, but only if there are requested related keywords.\n\t\t\tif ( requestedRelatedKeywordKeys.length > 1 ) {\n\t\t\t\tthis._results.seo = pickBy( this._results.seo, ( relatedKeyword, key ) => includes( requestedRelatedKeywordKeys, key ) );\n\t\t\t}\n\t\t}\n\n\t\tif ( this._configuration.contentAnalysisActive && this._contentAssessor && shouldReadabilityUpdate ) {\n\t\t\tthis._contentAssessor.assess( this._paper );\n\n\t\t\tthis._results.readability = {\n\t\t\t\tresults: this._contentAssessor.results,\n\t\t\t\tscore: this._contentAssessor.calculateOverallScore(),\n\t\t\t};\n\t\t}\n\n\t\treturn this._results;\n\t}\n\n\t/**\n\t * Loads a new script from an external source.\n\t *\n\t * @param {number} id  The request id.\n\t * @param {string} url The url of the script to load;\n\t *\n\t * @returns {Object} An object containing whether or not the url was loaded, the url and possibly an error message.\n\t */\n\tloadScript( id, { url } ) {\n\t\tif ( isUndefined( url ) ) {\n\t\t\treturn { loaded: false, url, message: \"Load Script was called without an URL.\" };\n\t\t}\n\n\t\ttry {\n\t\t\tthis._scope.importScripts( url );\n\t\t} catch ( error ) {\n\t\t\treturn { loaded: false, url, message: error.message };\n\t\t}\n\n\t\treturn { loaded: true, url };\n\t}\n\n\t/**\n\t * Sends the load script result back.\n\t *\n\t * @param {number} id     The request id.\n\t * @param {Object} result The result.\n\t *\n\t * @returns {void}\n\t */\n\tloadScriptDone( id, result ) {\n\t\tif ( ! result.loaded ) {\n\t\t\tthis.send( \"loadScript:failed\", id, result );\n\t\t\treturn;\n\t\t}\n\n\t\tthis.send( \"loadScript:done\", id, result );\n\t}\n\n\t/**\n\t * Sends the analyze result back.\n\t *\n\t * @param {number} id     The request id.\n\t * @param {Object} result The result.\n\t *\n\t * @returns {void}\n\t */\n\tanalyzeDone( id, result ) {\n\t\tif ( result.error ) {\n\t\t\tthis.send( \"analyze:failed\", id, result );\n\t\t\treturn;\n\t\t}\n\t\tthis.send( \"analyze:done\", id, result );\n\t}\n\n\t/**\n\t * Sends the analyze related keywords result back.\n\t *\n\t * @param {number} id     The request id.\n\t * @param {Object} result The result.\n\t *\n\t * @returns {void}\n\t */\n\tanalyzeRelatedKeywordsDone( id, result ) {\n\t\tif ( result.error ) {\n\t\t\tthis.send( \"analyzeRelatedKeywords:failed\", id, result );\n\t\t\treturn;\n\t\t}\n\t\tthis.send( \"analyzeRelatedKeywords:done\", id, result );\n\t}\n\n\t/**\n\t * Handle a custom message using the registered handler.\n\t *\n\t * @param {number} id   The request id.\n\t * @param {string} name The name of the message.\n\t * @param {Object} data The data of the message.\n\t *\n\t * @returns {Object} An object containing either success and data or an error.\n\t */\n\tcustomMessage( id, { name, data } ) {\n\t\ttry {\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tdata: this._registeredMessageHandlers[ name ]( data ),\n\t\t\t};\n\t\t} catch ( error ) {\n\t\t\treturn { error };\n\t\t}\n\t}\n\n\t/**\n\t * Send the result of a custom message back.\n\t *\n\t * @param {number} id     The request id.\n\t * @param {Object} result The result.\n\t *\n\t * @returns {void}\n\t */\n\tcustomMessageDone( id, result ) {\n\t\tif ( result.success ) {\n\t\t\tthis.send( \"customMessage:done\", id, result.data );\n\t\t\treturn;\n\t\t}\n\t\tthis.send( \"customMessage:failed\", result.error );\n\t}\n\n\t/**\n\t * Runs the specified research in the worker. Optionally pass a paper.\n\t *\n\t * @param {number} id     The request id.\n\t * @param {string} name   The name of the research to run.\n\t * @param {Paper} [paper] The paper to run the research on if it shouldn't\n\t *                        be run on the latest paper.\n\t *\n\t * @returns {Promise} The promise of the research.\n\t */\n\trunResearch( id, { name, paper = null } ) {\n\t\t// When a specific paper is passed we create a temporary new researcher.\n\t\tconst researcher = paper === null\n\t\t\t? this._researcher\n\t\t\t: new Researcher( paper );\n\n\t\treturn researcher.getResearch( name );\n\t}\n\n\t/**\n\t * Send the result of a custom message back.\n\t *\n\t * @param {number} id     The request id.\n\t * @param {Object} result The result.\n\t *\n\t * @returns {void}\n\t */\n\trunResearchDone( id, result ) {\n\t\tthis.send( \"runResearch:done\", id, result );\n\t}\n}\n"]}