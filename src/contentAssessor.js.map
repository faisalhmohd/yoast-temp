{"version":3,"sources":["../../src/contentAssessor.js"],"names":["ContentAssessor","i18n","options","call","type","locale","hasOwnProperty","_assessments","fleschReading","sentenceLength","require","inherits","prototype","calculatePenaltyPointsFullSupport","rating","calculatePenaltyPointsPartialSupport","_allAssessmentsSupported","numberOfAssessments","applicableAssessments","getApplicableAssessments","length","calculatePenaltyPoints","results","getValidResults","penaltyPoints","result","getScore","bind","_ratePenaltyPoints","totalPenaltyPoints","calculateOverallScore"],"mappings":"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","file":"contentAssessor.js","sourcesContent":["import Assessor from \"./assessor.js\";\nimport FleschReadingEase from \"./assessments/readability/fleschReadingEaseAssessment.js\";\nimport paragraphTooLong from \"./assessments/readability/paragraphTooLongAssessment.js\";\nimport SentenceLengthInText from \"./assessments/readability/sentenceLengthInTextAssessment.js\";\nimport SubheadingDistributionTooLong from \"./assessments/readability/subheadingDistributionTooLongAssessment.js\";\nimport transitionWords from \"./assessments/readability/transitionWordsAssessment.js\";\nimport passiveVoice from \"./assessments/readability/passiveVoiceAssessment.js\";\nimport sentenceBeginnings from \"./assessments/readability/sentenceBeginningsAssessment.js\";\nimport textPresence from \"./assessments/readability/textPresenceAssessment.js\";\nimport contentConfiguration from \"./config/content/combinedConfig.js\";\n\n/*\n\tTemporarily disabled:\n\n\tvar wordComplexity = require( \"./assessments/wordComplexityAssessment.js\" );\n\tvar sentenceLengthInDescription = require( \"./assessments/sentenceLengthInDescriptionAssessment.js\" );\n */\n\nimport scoreToRating from \"./interpreters/scoreToRating\";\n\nimport { map } from \"lodash-es\";\nimport { sum } from \"lodash-es\";\n\n/**\n * Creates the Assessor\n *\n * @param {object} i18n The i18n object used for translations.\n * @param {Object} options The options for this assessor.\n * @param {Object} options.marker The marker to pass the list of marks to.\n * @param {string} options.locale The locale.\n *\n * @constructor\n */\nconst ContentAssessor = function( i18n, options = {} ) {\n\tAssessor.call( this, i18n, options );\n\tthis.type = \"ContentAssessor\";\n\tconst locale = ( options.hasOwnProperty( \"locale\" ) ) ? options.locale : \"en_US\";\n\n\tthis._assessments = [\n\n\t\tnew FleschReadingEase( contentConfiguration( locale ).fleschReading ),\n\t\tnew SubheadingDistributionTooLong(),\n\t\tparagraphTooLong,\n\t\tnew SentenceLengthInText( contentConfiguration( locale ).sentenceLength ),\n\t\ttransitionWords,\n\t\tpassiveVoice,\n\t\ttextPresence,\n\t\tsentenceBeginnings,\n\t\t// Temporarily disabled: wordComplexity,\n\t];\n};\n\nrequire( \"util\" ).inherits( ContentAssessor, Assessor );\n\n/**\n * Calculates the weighted rating for languages that have all assessments based on a given rating.\n *\n * @param {number} rating The rating to be weighted.\n * @returns {number} The weighted rating.\n */\nContentAssessor.prototype.calculatePenaltyPointsFullSupport = function( rating ) {\n\tswitch ( rating ) {\n\t\tcase \"bad\":\n\t\t\treturn 3;\n\t\tcase \"ok\":\n\t\t\treturn 2;\n\t\tdefault:\n\t\tcase \"good\":\n\t\t\treturn 0;\n\t}\n};\n\n/**\n * Calculates the weighted rating for languages that don't have all assessments based on a given rating.\n *\n * @param {number} rating The rating to be weighted.\n * @returns {number} The weighted rating.\n */\nContentAssessor.prototype.calculatePenaltyPointsPartialSupport = function( rating ) {\n\tswitch ( rating ) {\n\t\tcase \"bad\":\n\t\t\treturn 4;\n\t\tcase \"ok\":\n\t\t\treturn 2;\n\t\tdefault:\n\t\tcase \"good\":\n\t\t\treturn 0;\n\t}\n};\n\n/**\n * Determines whether a language is fully supported. If a language supports 8 content assessments\n * it is fully supported\n *\n * @returns {boolean} True if fully supported.\n */\nContentAssessor.prototype._allAssessmentsSupported = function() {\n\tconst numberOfAssessments = 8;\n\tconst applicableAssessments = this.getApplicableAssessments();\n\treturn applicableAssessments.length === numberOfAssessments;\n};\n\n/**\n * Calculates the penalty points based on the assessment results.\n *\n * @returns {number} The total penalty points for the results.\n */\nContentAssessor.prototype.calculatePenaltyPoints = function() {\n\tconst results = this.getValidResults();\n\n\tconst penaltyPoints = map( results, function( result ) {\n\t\tconst rating = scoreToRating( result.getScore() );\n\n\t\tif ( this._allAssessmentsSupported() ) {\n\t\t\treturn this.calculatePenaltyPointsFullSupport( rating );\n\t\t}\n\n\t\treturn this.calculatePenaltyPointsPartialSupport( rating );\n\t}.bind( this ) );\n\n\treturn sum( penaltyPoints );\n};\n\n/**\n * Rates the penalty points\n *\n * @param {number} totalPenaltyPoints The amount of penalty points.\n * @returns {number} The score based on the amount of penalty points.\n *\n * @private\n */\nContentAssessor.prototype._ratePenaltyPoints = function( totalPenaltyPoints ) {\n\tif ( this.getValidResults().length === 1 ) {\n\t\t// If we have only 1 result, we only have a \"no content\" result\n\t\treturn 30;\n\t}\n\n\tif ( this._allAssessmentsSupported() ) {\n\t\t// Determine the total score based on the total penalty points.\n\t\tif ( totalPenaltyPoints > 6 ) {\n\t\t\t// A red indicator.\n\t\t\treturn 30;\n\t\t}\n\n\t\tif ( totalPenaltyPoints > 4 ) {\n\t\t\t// An orange indicator.\n\t\t\treturn 60;\n\t\t}\n\t} else {\n\t\tif ( totalPenaltyPoints > 4 ) {\n\t\t\t// A red indicator.\n\t\t\treturn 30;\n\t\t}\n\n\t\tif ( totalPenaltyPoints > 2 ) {\n\t\t\t// An orange indicator.\n\t\t\treturn 60;\n\t\t}\n\t}\n\t// A green indicator.\n\treturn 90;\n};\n\n/**\n * Calculates the overall score based on the assessment results.\n *\n * @returns {number} The overall score.\n */\nContentAssessor.prototype.calculateOverallScore = function() {\n\tconst results = this.getValidResults();\n\n\t// If you have no content, you have a red indicator.\n\tif ( results.length === 0 ) {\n\t\treturn 30;\n\t}\n\n\tconst totalPenaltyPoints = this.calculatePenaltyPoints();\n\n\treturn this._ratePenaltyPoints( totalPenaltyPoints );\n};\n\nexport default ContentAssessor;\n\n"]}