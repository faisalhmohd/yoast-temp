{"version":3,"sources":["../../../../src/assessments/readability/subheadingDistributionTooLongAssessment.js"],"names":["SubheadingsDistributionTooLong","config","defaultConfig","parameters","recommendedMaximumWordCount","slightlyTooMany","farTooMany","urlTitle","urlCallToAction","scores","goodShortTextNoSubheadings","goodSubheadings","okSubheadings","badSubheadings","badLongTextNoSubheadings","identifier","_config","paper","researcher","i18n","_subheadingTextsLength","getResearch","sort","a","b","wordCount","_tooLongTextsNumber","getTooLongSubheadingTexts","length","assessmentResult","setIdentifier","_hasSubheadings","hasSubheadings","_textLength","getText","calculatedResult","calculateResult","resultTextPlural","setScore","score","setText","resultText","hasText","subheadings","subheading","bind","longestSubheadingTextLength","sprintf","dgettext","dngettext"],"mappings":"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","file":"subheadingDistributionTooLongAssessment.js","sourcesContent":["import { filter, merge } from \"lodash-es\";\n\nimport Assessment from \"../../assessment\";\nimport { inRangeEndInclusive as inRange } from \"../../helpers/inRange\";\nimport isTextTooLong from \"../../helpers/isValueTooLong\";\nimport { createAnchorOpeningTag } from \"../../helpers/shortlinker\";\nimport { getSubheadings } from \"../../stringProcessing/getSubheadings\";\nimport getWords from \"../../stringProcessing/getWords\";\nimport AssessmentResult from \"../../values/AssessmentResult\";\n\n/**\n * Represents the assessment for calculating the text after each subheading.\n */\nclass SubheadingsDistributionTooLong extends Assessment {\n\t/**\n\t * Sets the identifier and the config.\n\t *\n\t * @param {Object} config The configuration to use.\n\t * @returns {void}\n\t */\n\tconstructor( config = {} ) {\n\t\tsuper();\n\n\t\tconst defaultConfig = {\n\t\t\tparameters: {\n\t\t\t\t// The maximum recommended value of the subheading text.\n\t\t\t\trecommendedMaximumWordCount: 300,\n\t\t\t\tslightlyTooMany: 300,\n\t\t\t\tfarTooMany: 350,\n\t\t\t},\n\t\t\turlTitle: createAnchorOpeningTag( \"https://yoa.st/34x\" ),\n\t\t\turlCallToAction: createAnchorOpeningTag( \"https://yoa.st/34y\" ),\n\t\t\tscores: {\n\t\t\t\tgoodShortTextNoSubheadings: 9,\n\t\t\t\tgoodSubheadings: 9,\n\t\t\t\tokSubheadings: 6,\n\t\t\t\tbadSubheadings: 3,\n\t\t\t\tbadLongTextNoSubheadings: 2,\n\t\t\t},\n\t\t};\n\n\t\tthis.identifier = \"subheadingsTooLong\";\n\t\tthis._config = merge( defaultConfig, config );\n\t}\n\n\t/**\n\t * Runs the getSubheadingTextLength research and checks scores based on length.\n\t *\n\t * @param {Paper} paper The paper to use for the assessment.\n\t * @param {Researcher} researcher The researcher used for calling research.\n\t * @param {Object} i18n The object used for translations.\n\t *\n\t * @returns {AssessmentResult} The assessment result.\n\t */\n\tgetResult( paper, researcher, i18n ) {\n\t\tthis._subheadingTextsLength = researcher.getResearch( \"getSubheadingTextLengths\" );\n\n\t\tthis._subheadingTextsLength = this._subheadingTextsLength.sort( function( a, b ) {\n\t\t\treturn b.wordCount - a.wordCount;\n\t\t} );\n\n\t\tthis._tooLongTextsNumber = this.getTooLongSubheadingTexts().length;\n\n\t\tconst assessmentResult = new AssessmentResult();\n\t\tassessmentResult.setIdentifier( this.identifier );\n\n\t\tthis._hasSubheadings = this.hasSubheadings( paper );\n\n\t\tthis._textLength = getWords( paper.getText() ).length;\n\n\t\tconst calculatedResult = this.calculateResult( i18n );\n\t\tcalculatedResult.resultTextPlural = calculatedResult.resultTextPlural || \"\";\n\t\tassessmentResult.setScore( calculatedResult.score );\n\t\tassessmentResult.setText( calculatedResult.resultText );\n\n\t\treturn assessmentResult;\n\t}\n\n\t/**\n\t * Checks whether the paper has text.\n\t *\n\t * @param {Paper} paper The paper to use for the assessment.\n\t *\n\t * @returns {boolean} True when there is text.\n\t */\n\tisApplicable( paper ) {\n\t\treturn paper.hasText();\n\t}\n\n\t/**\n\t * Checks whether the paper has subheadings.\n\t *\n\t * @param {Paper} paper The paper to use for the assessment.\n\t *\n\t * @returns {boolean} True when there is at least one subheading.\n\t */\n\thasSubheadings( paper ) {\n\t\tconst subheadings = getSubheadings( paper.getText() );\n\t\treturn subheadings.length > 0;\n\t}\n\n\t/**\n\t * Counts the number of subheading texts that are too long.\n\t *\n\t * @returns {number} The number of subheading texts that are too long.\n\t */\n\tgetTooLongSubheadingTexts() {\n\t\treturn filter( this._subheadingTextsLength, function( subheading ) {\n\t\t\treturn isTextTooLong( this._config.parameters.recommendedMaximumWordCount, subheading.wordCount );\n\t\t}.bind( this ) );\n\t}\n\n\t/**\n\t * Calculates the score and creates a feedback string based on the subheading texts length.\n\t *\n\t * @param {Object} i18n The object used for translations.\n\t *\n\t * @returns {Object} The calculated result.\n\t */\n\tcalculateResult( i18n ) {\n\t\tif ( this._textLength > 300 ) {\n\t\t\tif ( this._hasSubheadings ) {\n\t\t\t\tconst longestSubheadingTextLength = this._subheadingTextsLength[ 0 ].wordCount;\n\t\t\t\tif ( longestSubheadingTextLength <= this._config.parameters.slightlyTooMany ) {\n\t\t\t\t\t// Green indicator.\n\t\t\t\t\treturn {\n\t\t\t\t\t\tscore: this._config.scores.goodSubheadings,\n\t\t\t\t\t\tresultText: i18n.sprintf(\n\t\t\t\t\t\t\t// Translators: %1$s expands to a link to https://yoa.st/headings, %2$s expands to the link closing tag.\n\t\t\t\t\t\t\ti18n.dgettext(\n\t\t\t\t\t\t\t\t\"js-text-analysis\",\n\t\t\t\t\t\t\t\t\"%1$sSubheading distribution%2$s: Great job!\"\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tthis._config.urlTitle,\n\t\t\t\t\t\t\t\"</a>\"\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif ( inRange( longestSubheadingTextLength, this._config.parameters.slightlyTooMany, this._config.parameters.farTooMany ) ) {\n\t\t\t\t\t// Orange indicator.\n\t\t\t\t\treturn {\n\t\t\t\t\t\tscore: this._config.scores.okSubheadings,\n\t\t\t\t\t\tresultText: i18n.sprintf(\n\t\t\t\t\t\t\t/*\n\t\t\t\t\t\t\t * Translators: %1$s and %5$s expand to a link on yoast.com, %3$d to the number of text sections\n\t\t\t\t\t\t\t * not separated by subheadings, %4$d expands to the recommended number of words following a\n\t\t\t\t\t\t\t * subheading, %2$s expands to the link closing tag.\n\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\ti18n.dngettext(\n\t\t\t\t\t\t\t\t\"js-text-analysis\",\n\t\t\t\t\t\t\t\t\"%1$sSubheading distribution%2$s: %3$d section of your text is longer than %4$d words and\" +\n\t\t\t\t\t\t\t\t\" is not separated by any subheadings. %5$sAdd subheadings to improve readability%2$s.\",\n\t\t\t\t\t\t\t\t\"%1$sSubheading distribution%2$s: %3$d sections of your text are longer than %4$d words \" +\n\t\t\t\t\t\t\t\t\"and are not separated by any subheadings. %5$sAdd subheadings to improve readability%2$s.\",\n\t\t\t\t\t\t\t\tthis._tooLongTextsNumber ),\n\t\t\t\t\t\t\tthis._config.urlTitle,\n\t\t\t\t\t\t\t\"</a>\",\n\t\t\t\t\t\t\tthis._tooLongTextsNumber,\n\t\t\t\t\t\t\tthis._config.parameters.recommendedMaximumWordCount,\n\t\t\t\t\t\t\tthis._config.urlCallToAction,\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// Red indicator.\n\t\t\t\treturn {\n\t\t\t\t\tscore: this._config.scores.badSubheadings,\n\t\t\t\t\tresultText: i18n.sprintf(\n\t\t\t\t\t\t/* Translators: %1$s and %5$s expand to a link on yoast.com, %3$d to the number of text sections\n\t\t\t\t\t\tnot separated by subheadings, %4$d expands to the recommended number of words following a\n\t\t\t\t\t\tsubheading, %2$s expands to the link closing tag. */\n\t\t\t\t\t\ti18n.dngettext(\n\t\t\t\t\t\t\t\"js-text-analysis\",\n\t\t\t\t\t\t\t\"%1$sSubheading distribution%2$s: %3$d section of your text is longer than %4$d words and\" +\n\t\t\t\t\t\t\t\" is not separated by any subheadings. %5$sAdd subheadings to improve readability%2$s.\",\n\t\t\t\t\t\t\t\"%1$sSubheading distribution%2$s: %3$d sections of your text are longer than %4$d words \" +\n\t\t\t\t\t\t\t\"and are not separated by any subheadings. %5$sAdd subheadings to improve readability%2$s.\",\n\t\t\t\t\t\t\tthis._tooLongTextsNumber ),\n\t\t\t\t\t\tthis._config.urlTitle,\n\t\t\t\t\t\t\"</a>\",\n\t\t\t\t\t\tthis._tooLongTextsNumber,\n\t\t\t\t\t\tthis._config.parameters.recommendedMaximumWordCount,\n\t\t\t\t\t\tthis._config.urlCallToAction,\n\t\t\t\t\t),\n\t\t\t\t};\n\t\t\t}\n\t\t\t// Red indicator, use '2' so we can differentiate in external analysis.\n\t\t\treturn {\n\t\t\t\tscore: this._config.scores.badLongTextNoSubheadings,\n\t\t\t\tresultText: i18n.sprintf(\n\t\t\t\t\t/* Translators: %1$s and %3$s expand to a link to https://yoa.st/headings, %2$s expands to the link closing tag. */\n\t\t\t\t\ti18n.dgettext(\n\t\t\t\t\t\t\"js-text-analysis\",\n\t\t\t\t\t\t\"%1$sSubheading distribution%2$s: You are not using any subheadings, although your text is rather long.\" +\n\t\t\t\t\t\t\" %3$sTry and add some subheadings%2$s.\"\n\t\t\t\t\t),\n\t\t\t\t\tthis._config.urlTitle,\n\t\t\t\t\t\"</a>\",\n\t\t\t\t\tthis._config.urlCallToAction\n\t\t\t\t),\n\t\t\t};\n\t\t}\n\t\tif ( this._hasSubheadings ) {\n\t\t\t// Green indicator.\n\t\t\treturn {\n\t\t\t\tscore: this._config.scores.goodSubheadings,\n\t\t\t\tresultText: i18n.sprintf(\n\t\t\t\t\t/* Translators: %1$s expands to a link to https://yoa.st/headings, %2$s expands to the link closing tag. */\n\t\t\t\t\ti18n.dgettext(\n\t\t\t\t\t\t\"js-text-analysis\",\n\t\t\t\t\t\t\"%1$sSubheading distribution%2$s: Great job!\"\n\t\t\t\t\t),\n\t\t\t\t\tthis._config.urlTitle,\n\t\t\t\t\t\"</a>\"\n\t\t\t\t),\n\t\t\t};\n\t\t}\n\t\t// Green indicator.\n\t\treturn {\n\t\t\tscore: this._config.scores.goodShortTextNoSubheadings,\n\t\t\tresultText: i18n.sprintf(\n\t\t\t\t/* Translators: %1$s expands to a link to https://yoa.st/headings, %2$s expands to the link closing tag. */\n\t\t\t\ti18n.dgettext(\n\t\t\t\t\t\"js-text-analysis\",\n\t\t\t\t\t\"%1$sSubheading distribution%2$s: You are not using any subheadings, but your text is short enough\" +\n\t\t\t\t\t\" and probably doesn't need them.\"\n\t\t\t\t),\n\t\t\t\tthis._config.urlTitle,\n\t\t\t\t\"</a>\"\n\t\t\t),\n\t\t};\n\t}\n}\n\nexport default SubheadingsDistributionTooLong;\n"]}