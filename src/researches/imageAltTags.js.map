{"version":3,"sources":["../../../src/researches/imageAltTags.js"],"names":["paper","researcher","topicForms","getResearch","matchAltProperties","getText","getLocale","matchFound","matchResult","process","env","YOAST_RECALIBRATION","percentWordMatches","countWordMatches","imageMatches","locale","altProperties","noAlt","withAlt","withAltKeyword","withAltNonKeyword","i","length","alttag","keyphraseForms","keywordMatchedInAltTag"],"mappings":";;;;;;kBA2Ee,UAAUA,KAAV,EAAiBC,UAAjB,EAA8B;AAC5C,KAAMC,aAAaD,WAAWE,WAAX,CAAwB,YAAxB,CAAnB;;AAEA,QAAOC,mBAAoB,2BAAaJ,MAAMK,OAAN,EAAb,CAApB,EAAoDH,UAApD,EAAgEF,MAAMM,SAAN,EAAhE,CAAP;AACA,C;;AA7ED;;;;AACA;;;;AACA;;AAEA;;;;AAEA;;;;;;;AARA;;AAeA,IAAMC,aAAa,SAAbA,UAAa,CAAUC,WAAV,EAAwB;AAC1C,KAAKC,QAAQC,GAAR,CAAYC,mBAAZ,KAAoC,SAAzC,EAAqD;AACpD,SAAOH,YAAYI,kBAAZ,IAAkC,EAAzC;AACA;AACD,QAAOJ,YAAYK,gBAAZ,GAA+B,CAAtC;AACA,CALD;;AAOA;;;;;;;;;AASA,IAAMT,qBAAqB,SAArBA,kBAAqB,CAAUU,YAAV,EAAwBZ,UAAxB,EAAoCa,MAApC,EAA6C;AACvE,KAAMC,gBAAgB;AACrBC,SAAO,CADc;AAErBC,WAAS,CAFY;AAGrBC,kBAAgB,CAHK;AAIrBC,qBAAmB;AAJE,EAAtB;;AAOA,MAAM,IAAIC,IAAI,CAAd,EAAiBA,IAAIP,aAAaQ,MAAlC,EAA0CD,GAA1C,EAAgD;AAC/C,MAAME,SAAS,gCAAaT,aAAcO,CAAd,CAAb,CAAf;;AAEA;AACA,MAAKE,WAAW,EAAhB,EAAqB;AACpBP,iBAAcC,KAAd;AACA;AACA;;AAED;AACA,MAAK,uBAASf,WAAWsB,cAApB,CAAL,EAA4C;AAC3CR,iBAAcE,OAAd;AACA;AACA;;AAED;AACA,MAAMO,yBAAyB,sDAAwBvB,UAAxB,EAAoCqB,MAApC,EAA4C,IAA5C,EAAkDR,MAAlD,CAA/B;AACA,MAAKR,WAAYkB,sBAAZ,CAAL,EAA4C;AAC3CT,iBAAcG,cAAd;AACA;AACA;;AAEDH,gBAAcI,iBAAd;AACA;;AAED,QAAOJ,aAAP;AACA,CAlCD;;AAoCA","file":"imageAltTags.js","sourcesContent":["/** @module researches/imageAltTags */\n\nimport imageInText from \"../stringProcessing/imageInText\";\nimport imageAlttag from \"../stringProcessing/getAlttagContent\";\nimport { findTopicFormsInString } from \"../researches/findKeywordFormsInString\";\n\nimport { isEmpty } from \"lodash-es\";\n\n/**\n * Checks if a match was found based on different criteria in recalibration and in regular analysis.\n *\n * @param {Object} matchResult The object with the count and percent of words from the keyphrase that were matched.\n *\n * @returns {boolean} Whether a match was found or not.\n */\nconst matchFound = function( matchResult ) {\n\tif ( process.env.YOAST_RECALIBRATION === \"enabled\" ) {\n\t\treturn matchResult.percentWordMatches >= 50;\n\t}\n\treturn matchResult.countWordMatches > 0;\n};\n\n/**\n * Matches the alt-tags in the images found in the text.\n * Returns an object with the totals and different alt-tags.\n *\n * @param {Array} imageMatches Array with all the matched images in the text\n * @param {Object} topicForms The object with the keyphrase and the synonyms forms from the paper.\n * @param {string} locale The locale used for transliteration.\n * @returns {object} altProperties Object with all alt-tags that were found.\n */\nconst matchAltProperties = function( imageMatches, topicForms, locale ) {\n\tconst altProperties = {\n\t\tnoAlt: 0,\n\t\twithAlt: 0,\n\t\twithAltKeyword: 0,\n\t\twithAltNonKeyword: 0,\n\t};\n\n\tfor ( let i = 0; i < imageMatches.length; i++ ) {\n\t\tconst alttag = imageAlttag( imageMatches[ i ] );\n\n\t\t// If no alt-tag is set\n\t\tif ( alttag === \"\" ) {\n\t\t\taltProperties.noAlt++;\n\t\t\tcontinue;\n\t\t}\n\n\t\t// If no keyword is set, but the alt-tag is\n\t\tif ( isEmpty( topicForms.keyphraseForms ) ) {\n\t\t\taltProperties.withAlt++;\n\t\t\tcontinue;\n\t\t}\n\n\t\t// If the keyword is matched in the alt tag\n\t\tconst keywordMatchedInAltTag = findTopicFormsInString( topicForms, alttag, true, locale );\n\t\tif ( matchFound( keywordMatchedInAltTag ) ) {\n\t\t\taltProperties.withAltKeyword++;\n\t\t\tcontinue;\n\t\t}\n\n\t\taltProperties.withAltNonKeyword++;\n\t}\n\n\treturn altProperties;\n};\n\n/**\n * Checks the text for images, checks the type of each image and alt attributes for containing keywords\n *\n * @param {Paper} paper The paper to check for images.\n * @param {Researcher} researcher The researcher to use for analysis.\n *\n * @returns {object} Object containing all types of found images\n */\nexport default function( paper, researcher ) {\n\tconst topicForms = researcher.getResearch( \"morphology\" );\n\n\treturn matchAltProperties( imageInText( paper.getText() ), topicForms, paper.getLocale() );\n}\n"]}